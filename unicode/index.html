<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>유니코드를 입력</title>
<script src="https://chonggi-tokhu.github.io/files/kin_choice/new/ColourgreyShorterCSSJS-0.0.2.js"></script>
<!-- <script src="https://chonggi-tokhu.github.io/files/kin_choice/new/decs.js"></script> -->
 <script src="./decs.js"></script>
<link rel="stylesheet" href="https://chonggi-tokhu.github.io/files/kin_choice/new/ColourgreyShorter.css">
</head>
<body>
<div class="input-group"><input type="number" id="baseInput" max="32" min="2" placeholder="밑. 10진수,2진수,16진수 말고는 웬만해선 쓸일 없음"><input type="text" data-inputnumb-base="16" id="codeinput"><input type="text" id="preview" maxlength="1" onchange="this.parentElement.querySelector('#codeinput').value=this.value.charCodeAt(0);">
<button id="getCharfromCode">유니코드 복사</button><label><input type="checkbox" onchange="usingExecCommand=this.checked;">document.execCommand 함수를 사용하여 복사하기</label></div>
<script>
var usingExecCommand = false;
function setEl_Attr(el, attrname, attrval){
if (el instanceof HTMLElement || window["ColourgreyShorterJS"]?.checkHTMLElement(el)){
el.setAttribute(attrname, attrval);
el[attrname] = attrval;
}
}
var myInputs = [];
var myInput = null;
var copyBtn = document.getElementById("getCharfromCode");
function setInputs(){
for (var i = 2;i <= 36;i++){
var input_numbs_with_this_base = document.getEl_Attr("data-inputnumb-base", i.toString());
Array.from(input_numbs_with_this_base).forEach((el,idx,par)=>{
setEl_Attr(el, "data-decval", CGRConvertDec.converter.convert(el.value, 16, 10));
el.addEventListener("change", (ev)=>{ setEl_Attr(el, "data-decval", CGRConvertDec.converter.convert(el.value, 16, 10)); var char =  getUnicodeChar(myInput.getAttribute("data-decval"), 10);  document.getElementById("preview").value=char; });
myInputs.push(el);
});
}
}
var baseInput = document.getElementById("baseInput");
baseInput.addEventListener("change",(ev)=>{
  document.getElementById("codeinput").setAttribute("data-inputnumb-base",baseInput.value);
});
myInput = myInputs[0];
function getUTF16CharFromCharCode(code, base){
return String.fromCharCode(parseInt(CGRConvertDec.converter.convert(code, base, 10)));
}
function getStrLen(str,charsRule,{ruleMode}={ruleMode:0}){
  var rtv=0;
  if (!(typeof str==="string"||str instanceof String)){
    return rtv;
  }
  var regExpRuleFunc=(param)=>param,charsToExcludeFunc=(param)=>param,charsToIncludeOnlyTheseFunc=(param)=>param;
  if (charsRule instanceof RegExp){
    if (ruleMode===0){
      regExpRuleFunc=(str0)=>{
        if (!(typeof str0==="string"||str0 instanceof String)){
          return "";
        }
        return str0.replace(charsRule,"");
      }
    } else if (ruleMode===1){
      regExpRuleFunc=(str0)=>{
        if (!(typeof str0==="string"||str0 instanceof String)){
          return "";
        }
        /* for(var replacedStr of Array.from(str0.match(charsRule)).filter(val=>val!==null)) {
          str0=str0.replace(replacedStr,"");
        } */
        return Array.from(str0.match(charsRule)).filter(val=>val!==null).join("");
      }
    }
  } else if (charsRule instanceof Array){
    if (ruleMode===0){
      charsToExcludeFunc=(str0)=>{
        if (!(typeof str0==="string"||str0 instanceof String)){
          return "";
        }
        return charsRule.includes(str0) ? "" : str0;
      }
    } else if (ruleMode===1){
      charsToIncludeOnlyTheseFunc=(str0)=>{
        if (!(typeof str0==="string"||str0 instanceof String)){
          return "";
        }
        return charsRule.includes(str0) ? str0 : "";
      }
    }
  }
  str = regExpRuleFunc(str);
  for (var i = 0;i<str.length;i++){
    /*
     var tempStr = charsToExcludeFunc(str[i]);
     tempStr = tempStr?charsToIncludeOnlyTheseFunc(str[i]):tempStr;
     rtv+=tempStr?1:0;
    */
    var f0=charsToExcludeFunc(str[i]);
    var f1=charsToIncludeOnlyTheseFunc(str[i]);
    //rtv += !f0 || !f1 ? 0:1;
    rtv += f0.length<1 || f1.length<1 ? 0:1;
  }
  return rtv;
}
function getUTF16Hexadec(code,base){
  var bin=CGRConvertDec.converter.convert(code,base,2).replace(/[^01]/g,"");
  //var binLen = getStrLen(bin,/[^01]/g,{ruleMode:0});
  //if (bin.length>0){}
  //귀찮음
  return;
}
function getUTF8Hexadec(code,base){
  var bin=CGRConvertDec.converter.convert(code,base,2).replace(/[^01]/g,"");
  var arr=[],binToHexadecArr=[],lastLen=0;
  /* if (bin.length>31){

  } else if (bin.length>26){

  } else if (bin.length>21){
    
  } else if (bin.length>16){
    
  } else if (bin.length>11){
    
  } else if (bin.length>7){
    
  } */
  if (code>2**31){
  } else if (code>2**26){
    bin="0".repeat(31-bin.length)+bin;
    arr=["1111110*","10******","10******","10******","10******","10******"];
  } else if (code>2**21){
    bin="0".repeat(26-bin.length)+bin;
    arr=["111110**","10******","10******","10******","10******"];
  } else if (code>2**16){
    bin="0".repeat(21-bin.length)+bin;
    arr=["11110***","10******","10******","10******"];
  } else if (code>2**11){
    bin="0".repeat(16-bin.length)+bin;
    arr=["1110****","10******","10******"];
  } else if (code>2**7){
    bin="0".repeat(11-bin.length)+bin;
    arr=["110*****","10******"]
  } else if (code>-1){
    bin="0".repeat(7-bin.length)+bin;
    arr=["0*******"];
  }
    console.log(bin);
    console.log(arr);
  for (var i = 0;i<arr.length;i++){
      var blanks=arr[i].replace(/[^\*]/g,'');
    var len = blanks.length;
      console.log(len);
    binToHexadecArr.push(arr[i].replace(blanks, bin.slice(lastLen,lastLen+len)));
      console.log(lastLen);
    lastLen += len;
  }
    console.log(binToHexadecArr);
  return binToHexadecArr.map(val=>CGRConvertDec.converter.convert(val,2,16));
}
var unicodeUsing={
  0:getUTF8Hexadec,
  1:getUTF16Hexadec
}
function getUnicodeChar(code,base,encoding=0){
  if (typeof unicodeUsing[encoding]!=="function"){
    return "";
  }
  return Uint8Array.from(unicodeUsing[encoding](code,base).map(val=>Number(CGRConvertDec.converter.convert(val,16,10)))).toString();
}
function getIfProtocolIsHTTPS(){
return new URL(location.href).protocol==="https:";
}
function copyElInner(el, ishttps, cbfunc){
if (!ColourgreyShorterJS.checkHTMLElement(el)){
return;
}
var range = null;
if (typeof document.body.createTextRange === "function"){
  range = document.body.createTextRange();
range.moveToElementText(el);
range.select();
} else if (typeof window.getSelection==="function"){
  
                var selection = window.getSelection();
                range = document.createRange();
                range.selectNodeContents(el);
                selection.removeAllRanges();
                selection.addRange(range);
}
if (range !== null){
if (ishttps){
navigator.clipboard.writeText(range).then((data)=>{ alert("복사함: "+el.innerText); if(typeof cbfunc==="function") { cbfunc(el, true); }; return data; }).catch((whyerr)=>{ alert("failed to copy");if(typeof cbfunc==="function") { cbfunc(el, false); }; return whyerr; }).finally((data)=>{ alert("복사 시도됨"); });
} else {
var succeeded = document.execCommand("copy");
if (!succeeded){
alert("failed to copy");
} else {
alert("복사함: "+el.innerText);
}
if (typeof cbfunc === "function") {
cbfunc(el, succeeded);
}
}
}
}
copyBtn.addEventListener("click", (ev)=>{ var char =  getUnicodeChar(myInput.getAttribute("data-decval"), 10); var newEl_pr = document.createElement("div"); var newEl = document.body.appendChild(newEl_pr); newEl.innerText = char; copyElInner(newEl, getIfProtocolIsHTTPS() && usingExecCommand, (elparam, succeeded)=>{ if (succeeded){ elparam?.remove(); } }); });

</script>
</body>
</html>
